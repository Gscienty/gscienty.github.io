<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>UploadPicture</title>
	<style media="screen">
		.hidden{
			display: none;
		}
		#ms-box{
			position:absolute;
			z-index: 2;
		}
		#ms-display{
			background-color: #fff;
			min-width: :2px;
			position: absolute;
			z-index: 2;
		}
		svg{
			position:absolute;
			top: 0;
		}
	</style>
	<script src="/javascripts/d3.min.js"></script>
</head>
<body>
<div id="canv">
	<div id='ms-display' class="hidden">
	</div>
	<div id='ms-box' class='hidden'>
		<input id='ms-close' type="button" value="X" />
		<input id='ms-label' type="text" name="label" value="" />
		<input id='ms-add' type="button" value="Add" />
		<script type="text/javascript">
			d3.select('#ms-close').on('click',function () {
				d3.select('#ms-box').classed({'hidden':true});
			});
			d3.select('#ms-add').on('click',function () {
				labels.push(document.getElementById('ms-label').value);

				svg.append('circle')
				.attr({
					cx:currentPosition[0],
					cy:currentPosition[1],
					r:Math.sqrt(Math.pow(currentPosition[0]-currentPosition[2],2)+Math.pow(currentPosition[1]-currentPosition[3],2)),
					stroke:'#330033',
					'stroke-width':2,
                    'fill-opacity' : 0,
					data:labels.length
				}).on('mouseover',function (){
					var choose = parseInt(this.getAttribute('data')) - 1;
					d3.select('#ms-display')
						.text(labels[choose])
						.classed({'hidden':false})
						.style({
						'top' : d3.mouse(this)[1] + 20 + 'px',
						'left' : d3.mouse(this)[0]+ 20 + 'px'
					});
				}).on('mouseout',function () {
					d3.select('#ms-display')
					.classed({'hidden':true});
				});

				d3.select('#ms-box').classed({'hidden':true});
				document.getElementById('ms-label').value = "";
			});
		</script>
	</div>
</div>

<script type="text/javascript">
	var currentPosition = [];
    var drawing = false;
    var rLine = svg.append('line')
        .attr({
            x0: 0,
            y0: 0,
            x1: 0,
            y1: 0,
            stroke: 1,
            'stroke-width' : '#000'
        });
	var labels = [];

	var svg = d3.select('#canv').append('svg').attr({width:500,height:600})
	    .append('image')
		.attr({
			'xlink:href':'/images/head.jpg',
			height: 300,
			width: 400
		}).on('click',function () {
            if(drawing){
                currentPosition.push(d3.mouse(this)[0]);
                currentPosition.push(d3.mouse(this)[1]);
    			d3.select('#ms-box').classed({'hidden':false}).style({
    				'top' : currentPosition[1]+'px',
    				'left' : currentPosition[0]+'px'
    			});
            }
            else{
    			currentPosition = [];
    			currentPosition.push(d3.mouse(this)[0]);
    			currentPosition.push(d3.mouse(this)[1]);
                drawing = true;
            }
		}).on('mousemove',function () {
            if(drawing){
                rLine.attr({
                    x0: currentPosition[0],
                    y0: currentPosition[1],
                    x1: d3.mouse(this)[0],
                    y1: d3.mouse(this)[1]
                });
            }
            else{
                rLine.attr({
                    x0: 0,
                    y0: 0,
                    x1: 0,
                    y1: 0
                });
            }
        });
</script>
</body>
</html>
