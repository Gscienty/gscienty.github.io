<html>
<head>
    <meta charset="utf-8" />
    <title>Bar example</title>
</head>

<body>
    <script type="text/javascript" src="../../javascripts/d3.min.js"></script>
    <div id="lastest-list">
        <div class="list-group-item item-limit col-md-10">
            <div id="journal-calculate-chart">
            </div>
            <script>
                //bar
                (function () {
                    var root = this;

                    var defOptions = {
                        left: 20,
                        top: 10,
                        bar_height: 30,
                        font_size: 18,
                        font_color: '#7c7c7c',
                        spacing_y: 20,
                        spacing_x: 140,
                        bar_color: '#e1efe1',
                        animate_Speed: 1000
                    };

                    var bar = function (id, opt) {

                        var options = opt == undefined ? defOptions : opt;
                        //create svg;
                        var svg = d3.select('#' + id).append('svg').attr('width', '100%').attr('height', '100%');
                        var svg_width = document.getElementById(id).clientWidth;
                        //set data array
                        var data = [];
                        //maximum data
                        var max_data;
                        //minimum data
                        var min_data;
                        //label max length
                        var label_text_max_length;
                        //bar label array
                        var labels = [];

                        //set display data array
                        //parameter #1 : data array
                        //parameter #2(ignore) : callback function which compare data element
                        this.set_data = function (d, m) {
                            data = d;
                            //ignore the data array which is empty
                            if (data.length != 0) {
                                //calculate max and min
                                max_data = data[0];
                                min_data = data[0];
                                data.forEach(function (i) {
                                    if (m == undefined) {
                                        if (max_data < i) {
                                            max_data = i;
                                        }
                                        if (min_data > i) {
                                            min_data = i;
                                        }
                                    }
                                    else {
                                        if (m(i, max_data) == -1) {
                                            max_data = i;
                                        }
                                        if (m(i, min_data) == 1) {
                                            min_data = i;
                                        }
                                    }
                                });
                                display_data();
                            };
                        };


                        //set label
                        //parameter #1 : label array
                        this.set_label = function (d) {
                            labels = d;
                            //ignore the label array which is empty
                            if (labels.length != 0) {
                                label_text_max_length = labels[0].length;
                                //calculate font max width
                                labels.forEach(function (i) {
                                    if (label_text_max_length < i.length) {
                                        label_text_max_length = i.length;
                                    }
                                });
                                display_labels();
                            }
                        };
                        //display labels
                        var display_labels = function () {
                            var ty = options.top + options.font_size
                            labels.forEach(function (i) {
                                svg.append('text')
                                    .text(i)
                                .attr({
                                    x: options.left,
                                    y: ty,

                                })
                                .style('font-size', options.font_size)
                                .style('fill', options.font_color);
                                ty = ty + options.bar_height + options.spacing_y;
                            });
                            svg.attr({ height: ty });
                        };
                        //display data
                        var display_data = function () {
                            var ty = options.top;
                            data.forEach(function (i) {
                                var bar_width = svg_width * i / max_data * 2 / 3;
                                var start_point_x = options.spacing_x;
                                svg.append('rect')
                                .attr({
                                    x: start_point_x,
                                    y: ty,
                                    width: 0,
                                    height: options.bar_height
                                })
                                .style('fill', '#fff')
                                .transition().duration(options.animate_Speed)
                                .attr({
                                    width: bar_width
                                })
                                .style('fill', options.bar_color);

                                svg.append('text')
                                    .text(i)
                                .attr({
                                    opacity: 0,
                                    x: bar_width + start_point_x + 12,
                                    y: ty + options.font_size
                                })
                                .style('font-size', options.font_size)
                                .style('fill', options.font_color)
                                .transition().duration(options.animate_Speed * 3)
                                .attr({
                                    opacity: 0.8
                                });

                                ty = ty + options.bar_height + options.spacing_y;
                            });
                        };

                    };
                    root.bar = bar;
                }).call(this);

                var b = new bar('journal-calculate-chart');
                b.set_label(['January','February','March','April','May','June','July','August','September','October','November','December']);
                b.set_data([Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random()]);
            </script>
        </div>
    </div>

</body>

</html>
