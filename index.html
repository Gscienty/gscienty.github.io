<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Gscienty Blog.</title>
        <link rel="stylesheet" href="fund/bootstrap.min.css" media="screen" title="no title" charset="utf-8" />
        <style media="screen">
            *{
                font-family: "Microsoft JhengHei";
                font-size: 20px;
            }
            body{
                background-color: #EDEDED;
            }
            .block{
                padding-top: 0%;
                width:40%;
                margin-left: auto;
                margin-right: auto;
            }
            .nava{
                position: relative;
                display: inline-block;
                outline: none;
                text-decoration: none;
                color: #000;
                text-shadow: 0px 0px 2px #000066;
                margin-left: 40px;
                padding-left: 10px;
                padding-right: 10px;
                padding-top: 10px;
                font-weight: 500;
                -webkit-transition: color 0.6s;
                transition: color 0.6s;
            }
            .nava:hover{
                color: #000033;
                -webkit-transition:color 0.6s;
                transition: color 0.6s;
                text-decoration: none;
                cursor:pointer;
            }

            .nava::before,.nava::after{
                position: absolute;
                opacity: 0;
                font-size: 150%;
                -webkit-transition: opacity 0.2s, -webkit-transform 0.2s;
                transition: opacity 0.2s, transform 0.2s;
            }
            .nava::before{
                left: -1em;
                top: 5px;
                content: '『';
                -webkit-transform: translateX(-100%);
                transform: translateX(-100%);
            }
            .nava::after{
                right: -0.5em;
                top: 5px;
                content: '』';
                -webkit-transform: translateX(100%);
                transform: translateX(100%);
            }
            .nava:hover::before, .nava:hover::after{
                opacity: 1;
                -webkit-transform: translateX(0);
                transform: translateX(0);
            }
            p{
                padding-top: 20px;
            }
            small{
                font-size:9px;
            }

            .ani_dot {
                font-family: simsun;
            }
            :root .ani_dot { /* 这里使用Hack是因为IE6~IE8浏览器下， vertical-align解析不规范，值为bottom或其他会改变按钮的实际高度*/
                display: inline-block;
                width: 20px;
                vertical-align: bottom;
                overflow: hidden;
            }
            @-webkit-keyframes dot {
                0% { width: 0; margin-right: 1.5em; }
                33% { width: .5em; margin-right: 1em; }
                66% { width: 1em; margin-right: .5em; }
                100% { width: 1.5em; margin-right: 0;}
            }
            .ani_dot {
                -webkit-animation: dot 3s infinite step-start;
            }

            @keyframes dot {
                0% { width: 0; margin-right: 1.5em; }
                33% { width: .5em; margin-right: 1em; }
                66% { width: 1em; margin-right: .5em; }
                100% { width: 1.5em; margin-right: 0;}
            }
            .ani_dot {
                animation: dot 3s infinite step-start;
            }
        </style>
    </head>
    <body>

        <div class="navbar">
            <div align="center" class="container" style="margin-top:80px;width:100%;min-height:300px;margin-left:auto; margin-right:auto;background-position:center;background-repeat:no-repeat; background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBhbGlnbj0iY2VudGVyIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTAgNjAgTDYwIDAgTDM0MCAwIEw0MDAgNjAgTDIwMCAyNzAgWiIgZmlsbD0iI0NDQ0M5OSIgLz48L3N2Zz4=);"></div>
        </div>

        <div class="container">
            <div align="center" class="block" style="margin-top:20px;width:100%"></div>
        </div>

        <div class="swap_block hidden"></div>

        <script src="fund/jquery-1.11.2.min.js" charset="utf-8"></script>
        <script src="fund/bootstrap.min.js" charset="utf-8"></script>
        <script src="fund/markdown.min.js" charset="utf-8"></script>


        <script type="text/javascript">
            //debug flag
            var DEBUG = false;
            //display block (div class)
            var DISPLAY_BLOCK = '.block';
            //swap block (div class)
            var SWAP_BLOCK = '.swap_block';
            //default fill block point display block
            var FILL_BLOCK = DISPLAY_BLOCK;

            function display_loading_icon(){
                //swap fill block point to swap block
                FILL_BLOCK = SWAP_BLOCK;
                $(DISPLAY_BLOCK).fadeOut(400, function(){
                    $(DISPLAY_BLOCK).html('<h1>Waiting <span class="ani_dot">...</span></h1>');
                    $(DISPLAY_BLOCK).fadeIn(800);
                    //need do it
                    $('body,html').animate({'scrollTop':$(window).scrollTop()+400},600);
                });
            }

            function checkout_content_use_html(cache){
                //animating time use swap space
                FILL_BLOCK = SWAP_BLOCK;

                //content response text to fill block
                $(FILL_BLOCK).html(cache);

                //begin animate
                $(DISPLAY_BLOCK).fadeOut(400, function(){
                    //finish animating use display space
                    FILL_BLOCK = DISPLAY_BLOCK;
                    //clear display block
                    $(DISPLAY_BLOCK).html('');

                    //copy swap space's inner html data to display space
                    $(FILL_BLOCK).html($(SWAP_BLOCK).html());
                    //clear swap space
                    $(SWAP_BLOCK).html('');

                    //show the display block (animate)
                    $(DISPLAY_BLOCK).fadeIn(800);
                    $('body,html').animate({'scrollTop':$(window).scrollTop()+400},600);
                });
            }

            //checkout block content method by url
            function checkout_content(data_url){
                $.ajax({
                    url : data_url,
                    async : false,
                    cache : false,
                    complete : function(data){
                        checkout_content_use_html(data.responseText);
                    },
                });
            };

            //cache stroke class only one instance
            (function(root){
                root.cache_strock = new (function(){
                     var stroke = {};

                     //add page cache room
                     this.load_page = function(key, data_url){
                         stroke[key] = {};
                         stroke[key]["type"] = "html";
                         stroke[key]["address"] = data_url;
                         stroke[key]["cached"] = false;
                     };

                     //add json cache page
                     this.load_json = function(key, data_url){
                         stroke[key] = {};
                         stroke[key]["type"] = "json";
                         stroke[key]["address"] = data_url;
                         stroke[key]["cached"] = false;
                     }

                     //get cache (lazy strategy)
                     this.get_data = function(key, execute_method){
                         if(stroke[key] != undefined){
                             if(stroke[key]["cached"]){
                                 execute_method(stroke[key]["value"]);
                             }
                             else{
                                 switch(stroke[key]["type"]){
                                 case "html":
                                     $.ajax({
                                         url : stroke[key]["address"],
                                         async : true,
                                         cache : false,
                                         complete : function(data){
                                             stroke[key]["value"] = data.responseText;
                                             execute_method(stroke[key]["value"]);
                                         }
                                     });
                                     break;
                                 case "json":
                                     $.getJSON(stroke[key]["address"]+'?'+Math.random(), null, function(result){
                                         stroke[key]["value"] = result;
                                         execute_method(stroke[key]["value"]);
                                     })
                                     break;
                                 }
                             }
                         }
                         else{
                             execute_method(null);
                         }
                     }
                });
            })(this);


            //fill cache stroke
            (function(stroke){
                $.ajaxSettings.async = false;   //close async switch
                $.getJSON("page_fund/db_need_cache.json?"+Math.random(), function(result){
                    for(property in result){
                        switch(result[property]["type"]){
                            case "html":
                                stroke.load_page(property, result[property]["address"]);
                            break;
                            case "json":
                                stroke.load_json(property, result[property]["address"]);
                            break;
                        }
                    }
                });
                $.ajaxSettings.async = true;    //open async switch
            })(cache_strock);
        </script>

        <script src="page_fund/page_script.js" charset="utf-8"></script>

        <script type="text/javascript">
            //router class
            var route = (function(root){
                root.router = function(){
                    this.address_info = {
                        parameters : [],
                        room : "",
                        page : ""
                    };

                    this.room_class_map = {};

                    //check key exists in the array
                    function exists_parameter(parameter_array, finded_key){
                        for(array_key in parameter_array){
                            if(array_key === finded_key) return true;
                        }
                        return false;
                    }

                    //update address information
                    this.update_address_info = function(){
                        //clear origin router message
                        this.address_info = [];
                        //get new router message by url
                        var url = window.location.href.split('#');
                        var parameters = new Array();
                        if(url.length > 1){
                            var param_elements = url[1].split('&');
                            for(var iterator = 0, param_elements_length = param_elements.length; iterator < param_elements_length; iterator++){
                                var key_value_pair = param_elements[iterator].split('=');
                                parameters[key_value_pair[0]] = key_value_pair[1];
                            }
                            this.address_info.parameters = parameters;
                        }

                        //get room message and page message by parameters
                        if(exists_parameter(this.address_info.parameters, "room")){
                            this.address_info.room = this.address_info.parameters["room"];

                            if(exists_parameter(this.address_info.parameters, "page")){
                                this.address_info.page = this.address_info.parameters["page"];
                            }
                            else{
                                this.page = "default";
                            }
                        }
                        else{
                            self.room = "face";
                            self.page = "default";
                        }
                    };

                    //initialize method
                    this.init = function(){
                        //get json response after method
                        var execute_method = function(){};

                        //update router message(address infomation)
                        this.update_address_info();
                        //get room parameter - class map
                        if(DEBUG){
                            this.room_class_map = {
                                "face" : {
                                    class_name : "face_room",
                                    execute_method : "execute",
                                }
                            };
                        }
                        else{
                            (function(self){
                                //async request master json data what used room name - class name map.
                                $.getJSON("page_fund/db_room_class_map.json?"+Math.random(), function(result){
                                    self.room_class_map = result;
                                    execute_method();
                                });
                            })(this);
                        }

                        return {
                            complete_method : function(method){
                                execute_method = method;
                            }
                        };
                    };

                    //finding page method
                    this.routing = function(){
                        //set default routing
                        if(this.address_info.room === undefined){
                            this.address_info.room = "face";
                            this.address_info.page = "default";
                        }

                        //find page use by route message
                        if(exists_parameter(this.room_class_map, this.address_info.room)){
                            return this.room_class_map[this.address_info.room];
                        }
                        else{
                            if(DEBUG){
                                this.address_info.room = "face";
                                this.address_info.page = "default";
                            }
                            else{
                                this.transfrom_404();
                            }
                             return this.routing();
                        }
                    }

                    //get page url's parameter array
                    this.get_parameters = function(){
                        return this.address_info.parameters;
                    }

                    //transfrom to 404 page
                    this.transfrom_404 = function(){
                        this.address_info.room = "method-page";
                        this.address_info.page = "404";
                        this.address_info.parameters['page'] = '404';
                    }

                    //transfrom to 500 page
                    this.transfrom_500 = function(){
                        this.address_info.room = "method-page";
                        this.address_info.page = "500";
                        this.address_info.parameters['page'] = '500';
                    }
                }

                return new root.router();
            })(this);

            //initialize router
            route.init().complete_method(function(){//adapt update route method render page by container
                (function(root, route){
                    //page component
                    var page_container = (function(root){
                        root.container = function(){
                            this.component_info = {};
                            this.component = null;

                            //update container information and get it
                            this.update_container = function(component, info){
                                //execute punish method for old page.
                                if(this.component != null){
                                    this.component.punish();
                                }
                                //set container and container information
                                this.component_info = info;
                                this.component = component;

                                //initialize this container
                                this.component.initialize();
                            };

                            this.execute = function(){
                                if(this.component_info.need_parameters){
                                    (this.component[this.component_info.execute_method])(this.component_info.parameters);
                                }
                                else{
                                    (this.component[this.component_info.execute_method])();
                                }
                            }
                        }

                        return new root.container();
                    })(root);

                    root.container_adapt = function(){
                        //temp var to cache route information(class name and main execute method)
                        var cache_routing_info = route.routing();
                        //temp var to cache address parameters
                        cache_routing_info.parameters = route.get_parameters();
                        try{
                            page_container.update_container(new this[cache_routing_info.class_name], cache_routing_info);
                            page_container.execute();
                        }
                        catch(e){
                            console.log(e);
                            route.transfrom_500();
                            root.container_adapt();
                        }
                    };

                    root.container_adapt();
                })(window, route);
            });

            //load nav data
            (function(nav_context){
                var execute_method = function(){};
                $.getJSON("page_fund/db_nav_list.json?"+Math.random(),function(result){
                    $.each(result.nav_list, function(key, value){
                        nav_context.append("<br /><a class='nava' room='" + value.room + "' page='" + value.page + "'>" + value.innerText + " <small>" + value.innerPostscript + "</small></a>")
                    });
                    //execute complete event
                    execute_method();
                });
                return {
                    complete_method : function(method){
                        execute_method = method;
                    }
                }
            })($(".navbar .container")).complete_method(function(){
                //rewrite nav 'a' click event
                $('.navbar a').click(function(){
                    //display waiting page
                    display_loading_icon();
                    //change url
                    window.location.href = '#room='+$(this).attr('room')+'&page='+$(this).attr('page');
                    //update address information by url
                    route.update_address_info();
                    //container apdate route change.
                    container_adapt();
                });
            });

        </script>
    </body>
</html>
